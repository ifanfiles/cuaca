<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cek API BMKG</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
    th { background: #eee; }
    pre { background: #f9f9f9; padding: 10px; border: 1px solid #ddd; max-height: 300px; overflow-y: scroll; }
    label { font-weight: bold; }
  </style>
</head>
<body>
  <h2>Data dari API BMKG</h2>

  <label for="adm4">Masukkan Kode ADM4:</label>
  <input type="text" id="adm4" value="31.71.01.1001" size="20">
  <button onclick="loadBMKG()">Ambil Data</button>

  <h3>JSON Mentah:</h3>
  <pre id="output">Klik tombol di atas untuk ambil data...</pre>

  <h3>Prakiraan (Tabel Ringkas):</h3>
  <table id="forecastTable">
    <thead>
      <tr>
        <th>Waktu</th>
        <th>Suhu (°C)</th>
        <th>Kelembapan (%)</th>
        <th>Cuaca</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function loadForecast(adm4) {
    const url = `https://api.bmkg.go.id/publik/prakiraan-cuaca?adm4=${adm4}`;
    const res = await fetch(url);
    const json = await res.json();

    document.getElementById("rawData").textContent = JSON.stringify(json, null, 2);

    const data = json.data?.[0]?.cuaca;
    if (!data) {
        document.getElementById("forecastTable").innerHTML = "<p>Tidak ada data prakiraan.</p>";
        return;
    }

    // Flatten array (gabung semua list prakiraan jadi satu array)
    const flatData = data.flat();

    // bikin tabel
    let html = `
      <table border="1" cellspacing="0" cellpadding="5">
        <thead>
          <tr>
            <th>Waktu Lokal</th>
            <th>Suhu (°C)</th>
            <th>Kelembapan (%)</th>
            <th>Cuaca</th>
            <th>Gambar</th>
          </tr>
        </thead>
        <tbody>
    `;

    flatData.forEach(item => {
        html += `
          <tr>
            <td>${item.local_datetime}</td>
            <td>${item.t}</td>
            <td>${item.hu}</td>
            <td>${item.weather_desc}</td>
            <td><img src="${item.image}" width="40"></td>
          </tr>
        `;
    });

    html += "</tbody></table>";
    document.getElementById("forecastTable").innerHTML = html;
}

  </script>
</body>
</html>
